/*!
 * palettify v0.0.0 
 * (c) 2017 Dobromir Hristov
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@mariotacke/color-thief")):"function"==typeof define&&define.amd?define(["@mariotacke/color-thief"],e):t.palettify=e(t.colorThief)}(this,function(t){"use strict";function e(t){switch(typeof t){case"string":case"number":case"boolean":return t;case"object":try{return null===t?"":JSON.stringify(t)}catch(t){return"{...}"}default:return""}}function n(t,e,r){if(void 0===r&&(r=0),"object"!=typeof t||null===t||void 0===t)return"";var o=e[r],a=t[o];return r===e.length-1?a:n(a,e,++r)}function r(t,e){return n(e,t.split("."))}function o(t,n,o){return void 0===n&&(n={}),void 0===o&&(o=r),"string"!=typeof t?t:t.replace(y,function(t,a){try{return e(o(a,n))}catch(t){return e(r(a,n))}})}function a(t){return!!t&&"object"==typeof t}function i(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"!==e&&"[object Date]"!==e}function l(t){return Array.isArray(t)?[]:{}}function s(t,e){return e&&!0===e.clone&&g(t)?f(l(t),t,e):t}function c(t,e,n){var r=t.slice();return e.forEach(function(e,o){void 0===r[o]?r[o]=s(e,n):g(e)?r[o]=f(t[o],e,n):-1===t.indexOf(e)&&r.push(s(e,n))}),r}function u(t,e,n){var r={};return g(t)&&Object.keys(t).forEach(function(e){r[e]=s(t[e],n)}),Object.keys(e).forEach(function(o){g(e[o])&&t[o]?r[o]=f(t[o],e[o],n):r[o]=s(e[o],n)}),r}function f(t,e,n){var r=Array.isArray(e),o=n||{arrayMerge:c},a=o.arrayMerge||c;return r?Array.isArray(t)?a(t,e,n):s(e,n):u(t,e,n)}function p(){function e(e,n){var r=y(e);return new Promise(function(e){p(r)?e((new t).getPalette(r,n)):r.onload=function(){e((new t).getPalette(r,n))}})}function n(t,e){return t.map(function(t,n){var o=1;return Array.isArray(e)&&e[n]&&(o=e[n]),r(t,o)})}function r(t,e){return"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")"}function o(t){var e=t.target,n=t.styles,r=t.palette,o=t.staticCallback;void 0===o&&(o=null);var a=t.obj;for(var i in n)n.hasOwnProperty(i)&&(e.style[i]=v(n[i],r));o&&o.call(e,a,m.options)}function a(t,e,n,r){for(var o in e)e.hasOwnProperty(o)&&!n.hasOwnProperty(o)?t.style[o]="":n.hasOwnProperty(o)&&(t.style[o]=v(n[o],r))}function i(t){m.options=h(E,t,{clone:!0,arrayMerge:d}),Object.keys(m.options).forEach(function(t){if(m.options[t]instanceof Error)throw m.options[t]})}function l(t){return(299*t[0]+587*t[1]+114*t[2])/1e3}function s(t){return l(t)<170}function c(t,e){return t.map(function(t){return s(t)?e.light:e.dark})}function u(t){var e=document.createElement("a");return e.href=t,e}function f(t){return document.location.host!==u(t).host}function p(t){return!!t.complete&&(void 0===t.naturalWidth||0!==t.naturalWidth)}function y(t){var e=t,n="IMG"!==e.tagName,r=n?t.style.backgroundImage.replace("url(","").replace(")","").replace(/"/gi,""):t.src,o=f(r);if(!e)throw Error("Target is not an element",e);if(n||o&&!e.crossOrigin){if(n&&!e.style.backgroundImage)throw Error("Tag provided is not an image and does not have a background-image style attached to it.");e=new Image(t.offsetWidth,t.offsetHeight),o&&(e.crossOrigin="anonymous"),e.src=r}return e}function d(t,e,n){return e}var g=!1,b=null,E={selector:Error("Please provide \u0430 selector in your options."),eventTarget:Error("Please provide an eventTarget as a parent for your image in the options."),image:Error("Please provide an image to sample."),styleTarget:null,contrastColors:{light:"#fff",dark:"#000"},activeClass:"palettify--active",readyClass:"palettify--ready",colorsToExtract:3,enterEvent:"mouseenter",leaveEvent:"mouseleave",styles:{opacities:[.5,.5,.5],static:{},dynamic:{}},staticCallback:null,beforeEnterCallback:null,afterEnterCallback:null,beforeLeaveCallback:null,afterLeaveCallback:null,onReadyCallback:null},m={options:{},data:[],collectElements:function(){var t="";if(!(b="string"==typeof m.options.selector?document.querySelector(m.options.selector):m.options.selector))throw new Error("Selector "+m.options.selector+" does not exist");t=b.querySelectorAll(m.options.eventTarget),[].slice.call(t,0).forEach(function(t){var e=t.querySelector(m.options.image),n=!0===m.options.styleTarget?t:t.querySelector(m.options.styleTarget||m.options.image),r={eventTarget:t,styleTarget:n,image:e,palette:{original:[],rgb:[],rgba:[]}};m.data.push(r)})},extractColorsAndAttachStyles:function(t){void 0===t&&(t=!1);var r=[];m.data.forEach(function(t,a){r[a]=e(t.image,m.options.colorsToExtract).then(function(e){t.palette.original=e,t.palette.rgb=n(t.palette.original,[]),t.palette.rgba=n(t.palette.original,m.options.styles.opacities),t.palette.contrastColors=c(t.palette.original,m.options.contrastColors),o({target:t.styleTarget,styles:m.options.styles.static,palette:t.palette,staticCallback:m.options.staticCallback,obj:t})})}),t||Promise.all(r).then(function(t){b.classList.add(m.options.readyClass),"function"==typeof m.options.onReadyCallback&&m.options.onReadyCallback.call(m,m)})},generateEnterHandler:function(t){return function(e){t.styleTarget&&("function"==typeof m.options.beforeEnterCallback&&m.options.beforeEnterCallback.call(t.styleTarget,t,m.options,e),t.styleTarget.classList.add(m.options.activeClass),o({target:t.styleTarget,styles:m.options.styles.dynamic,palette:t.palette,obj:t}),"function"==typeof m.options.afterEnterCallback&&m.options.afterEnterCallback.call(t.styleTarget,t,m.options,e))}},generateLeaveHandler:function(t){return function(e){var n=t.styleTarget;n&&("function"==typeof m.options.beforeLeaveCallback&&m.options.beforeLeaveCallback.call(t.styleTarget,t,m.options,e),n.classList.remove(m.options.activeClass),a(t.styleTarget,m.options.styles.dynamic,m.options.styles.static,t.palette),"function"==typeof m.options.afterLeaveCallback&&m.options.afterLeaveCallback.call(t.styleTarget,t,m.options,e))}},attachEventListeners:function(){var t=m.options,e=t.enterEvent,n=t.leaveEvent;e=Array.isArray(e)?e:[e],n=Array.isArray(n)?n:[n],m.data.forEach(function(t){t.enterHandler=m.generateEnterHandler(t),t.leaveHandler=m.generateLeaveHandler(t),e.forEach(function(e){t.eventTarget.addEventListener(e,t.enterHandler,!1)}),n.forEach(function(e){t.eventTarget.addEventListener(e,t.leaveHandler,!1)})})},detachEventListeners:function(){var t=m.options,e=t.enterEvent,n=t.leaveEvent;e=Array.isArray(e)?e:[e],n=Array.isArray(n)?n:[n],m.data.forEach(function(t){e.forEach(function(e){t.eventTarget.removeEventListener(e,t.enterHandler,!1)}),n.forEach(function(e){t.eventTarget.removeEventListener(e,t.leaveHandler,!1)})})},init:function(t){if(g)throw new Error("Palettify is already initialized");return i(t),m.collectElements(),m.extractColorsAndAttachStyles(),m.attachEventListeners(),g=!0,m},destroy:function(t){void 0===t&&(t=!0),m.detachEventListeners(),t&&m.cleanUp(),m.data=[],g=!1},reInit:function(){m.destroy(),m.init(m.options)},cleanUp:function(){m.data.forEach(function(t){for(var e in m.options.styles.static)m.options.styles.static.hasOwnProperty(e)&&(t.styleTarget.style[e]="")})},setOptions:function(t,e){void 0===e&&(e=!0),m.options=Object.assign({},m.options,t),e&&m.reInit()},isInitialized:function(){return g}};return m}t="default"in t?t.default:t;var y=/\{\{\s*(.*?)\s*\}\}/g,d=o,v=d,g=function(t){return a(t)&&i(t)};f.all=function(t,e){if(!Array.isArray(t)||t.length<2)throw new Error("first argument should be an array with at least two elements");return t.reduce(function(t,n){return f(t,n,e)})};var h=f;return p});